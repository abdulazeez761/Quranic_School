@using Hifz.DTOs
@using Hifz.Models.enums
@using Microsoft.Extensions.Localization
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["PageTitle"];
    ViewData["UseSelect2"] = true;
}
@model Hifz.DTOs.CreateClassDto

<!-- Page Header -->
<div class="d-flex justify-between align-center mb-lg flex-wrap gap-md">
    <div>
        <h2 class="section-title mb-sm">
            <i class='bx bx-edit-alt' style="color: var(--primary-green);"></i>
            @Localizer["PageTitle"]
        </h2>
        <p class="text-medium">@Localizer["PageDescription"]</p>
    </div>
    <div>
        <a asp-action="Index" class="btn btn-outline">
            <i class='bx bx-arrow-back'></i>
            <span>@Localizer["BackToList"]</span>
        </a>
    </div>
</div>

<!-- Validation Summary Alert -->
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger mb-lg" role="alert">
        <i class='bx bx-error-circle'></i>
        <div>
            <strong>@Localizer["ValidationErrors"]</strong>
            <div asp-validation-summary="All" class="mt-sm"></div>
        </div>
    </div>
}

<!-- Form Card -->
<div class="card card-standard" style="width: 70%; margin:0 auto;">
    <form asp-action="Create" method="post" class="form" id="classForm" data-validate>

        <!-- Basic Information Section -->
        <div class="card-header">
            <h3 class="card-title">
                <i class='bx bx-info-circle'></i>
                @Localizer["BasicInformation"]
            </h3>
        </div>

        <div class="card-body">
            <div class="form-row">
                <div class="form-group">
                    <label asp-for="Name" class="form-label required">
                        <i class='bx bx-book-bookmark'></i>
                        @Localizer["ClassName"]
                    </label>
                    <input asp-for="Name" class="form-input" placeholder="@Localizer["ClassNamePlaceholder"]"
                        autofocus />
                    <span asp-validation-for="Name" class="form-feedback form-feedback-invalid"></span>
                </div>

                <div class="form-group">
                    <label asp-for="Gender" class="form-label required">
                        <i class='bx bx-male-female'></i>
                        @Localizer["Gender"]
                    </label>
                    <select asp-for="Gender" class="form-select">
                        <option value="">@Localizer["SelectGender"]</option>
                        <option value="male">@Localizer["Male"]</option>
                        <option value="female">@Localizer["Female"]</option>
                    </select>
                    <span asp-validation-for="Gender" class="form-feedback form-feedback-invalid"></span>
                </div>
            </div>

            <div class="form-group">
                <label asp-for="ClassTime" class="form-label required">
                    <i class='bx bx-time'></i>
                    @Localizer["ClassTime"]
                </label>
                <input asp-for="ClassTime" type="time" class="form-input" />
                <small class="helper-text">@Localizer["ClassTimeHelper"]</small>
                <span asp-validation-for="ClassTime" class="form-feedback form-feedback-invalid"></span>
            </div>

            <div class="divider"></div>

            <!-- Class Schedule -->
            <h4 class="mb-md mt-lg d-flex align-center gap-sm">
                <i class='bx bx-calendar' style="color: var(--primary-green);"></i>
                @Localizer["ClassDays"]
            </h4>

            <div class="form-group">
                <label class="form-label required">
                    <i class='bx bx-calendar-check'></i>
                    @Localizer["SelectDays"]
                </label>
                <div class="days-container"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: var(--space-md); margin-top: var(--space-md);">
                    <label class="day-checkbox" for="sun">
                        <input type="checkbox" name="ClassDays" value="0" id="sun" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Sunday"]</span>
                    </label>
                    <label class="day-checkbox" for="mon">
                        <input type="checkbox" name="ClassDays" value="2" id="mon" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Monday"]</span>
                    </label>
                    <label class="day-checkbox" for="tue">
                        <input type="checkbox" name="ClassDays" value="3" id="tue" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Tuesday"]</span>
                    </label>
                    <label class="day-checkbox" for="wed">
                        <input type="checkbox" name="ClassDays" value="4" id="wed" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Wednesday"]</span>
                    </label>
                    <label class="day-checkbox" for="thu">
                        <input type="checkbox" name="ClassDays" value="5" id="thu" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Thursday"]</span>
                    </label>
                    <label class="day-checkbox" for="fri">
                        <input type="checkbox" name="ClassDays" value="6" id="fri" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Friday"]</span>
                    </label>
                    <label class="day-checkbox" for="sat">
                        <input type="checkbox" name="ClassDays" value="7" id="sat" />
                        <span class="day-checkbox-custom">
                            <i class='bx bx-check'></i>
                        </span>
                        <span class="day-label">@Localizer["Saturday"]</span>
                    </label>
                </div>
                <small class="helper-text">
                    <i class='bx bx-info-circle'></i>
                    @Localizer["DaysHelper"]
                </small>
                <span asp-validation-for="ClassDays" class="form-feedback form-feedback-invalid"></span>
            </div>

            <div class="divider"></div>

            <!-- Teachers and Students -->
            <h4 class="mb-md mt-lg d-flex align-center gap-sm">
                <i class='bx bx-group' style="color: var(--primary-green);"></i>
                @Localizer["TeachersAndStudents"]
            </h4>

            <div class="form-group">
                <label asp-for="TeacherIds" class="form-label">
                    <i class='bx bx-user-check'></i>
                    @Localizer["AssistantTeachers"]
                </label>
                <select asp-for="TeacherIds" class="form-select select2-teachers" multiple asp-items="ViewBag.Teachers">
                </select>
                <small class="helper-text">
                    <i class='bx bx-info-circle'></i>
                    @Localizer["TeachersHelper"]
                </small>
                <span asp-validation-for="TeacherIds" class="form-feedback form-feedback-invalid"></span>
            </div>

            <div class="form-group">
                <label asp-for="StudentsIds" class="form-label">
                    <i class='bx bx-group'></i>
                    @Localizer["Students"]
                </label>
                <select asp-for="StudentsIds" class="form-select select2-students" multiple
                    asp-items="ViewBag.Students">
                </select>
                <small class="helper-text">
                    <i class='bx bx-info-circle'></i>
                    @Localizer["StudentsHelper"]
                </small>
                <span asp-validation-for="StudentsIds" class="form-feedback form-feedback-invalid"></span>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="card-footer">
            <div class="form-actions form-actions-right">
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    <i class='bx bx-save'></i>
                    <span>@Localizer["SaveData"]</span>
                </button>
                <a asp-action="Index" class="btn btn-outline">
                    <i class='bx bx-x'></i>
                    <span>@Localizer["Cancel"]</span>
                </a>
            </div>
        </div>
    </form>
</div>

<!-- Help Card -->
<div class="card card-standard" style="width: 70%; margin:0 auto;">
    <div class="card-body">
        <h4 class="mb-md">
            <i class='bx bx-help-circle' style="color: var(--info);"></i>
            @Localizer["FillingInstructions"]
        </h4>
        <ul class="list-disc" style="margin-right: var(--space-lg); line-height: 1.8;">
            <li>@Localizer["Instruction1"]</li>
            <li>@Localizer["Instruction2"]</li>
            <li>@Localizer["Instruction3"]</li>
            <li>@Localizer["Instruction4"]</li>
            <li>@Localizer["Instruction5"]</li>
        </ul>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
            // Initialize Select2 for Teachers
            $('.select2-teachers').select2({
                placeholder: "@Localizer["SelectTeachers"]",
                allowClear: true,
                width: '100%',
                language: {
                    noResults: function () {
                        return "@Localizer["NoResults"]";
                    }
                }
            });

            // Initialize Select2 for Students
            $('.select2-students').select2({
                placeholder: "@Localizer["SelectStudents"]",
                allowClear: true,
                width: '100%',
                language: {
                    noResults: function () {
                        return "@Localizer["NoResults"]";
                    }
                }
            });
        });
    </script>
}